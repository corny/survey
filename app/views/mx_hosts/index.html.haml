%h1 MX-Hosts

.row
  .col-md-6
    %h3 STARTTLS support
    %dl.dl-horizontal.with-charts
      %dt supported
      %dd= MxHost.where(starttls: true).count
      %dt unsupported
      %dd= MxHost.where(starttls: false).count
      %dt unreachable
      %dd= MxHost.where(starttls: nil).count
  .col-md-6
    %h3 Certificate Validity
    %dl.dl-horizontal.with-charts
      %dt valid
      %dd= MxHost.where(cert_valid: true).count
      %dt invalid
      %dd= MxHost.where(cert_valid: false).count
      %dt unknown
      %dd= MxHost.where.not(certificate_id: nil).where(cert_valid: nil).count

%h3 Expiration
%dl.dl-horizontal.with-charts
  %dt expired
  %dd= MxHost.where(cert_expired: true).count
  %dt not expired
  %dd= MxHost.where(cert_expired: false).count

%h2 MX-Records with certificates
%dl.dl-horizontal.with-charts
  %dt valid an matching
  %dd= MxRecord.where(cert_matches: true).cert_valid(true).count

  %dt valid an not matching
  %dd= MxRecord.where(cert_matches: false).cert_valid(true).count

  %dt invalid and matching
  %dd= MxRecord.where(cert_matches: true).cert_valid(false).count

  %dt invalid and not matching
  %dd= MxRecord.where(cert_matches: false).cert_valid(false).count

%h2 TLS parameters

.row
  .col-md-6
    %h3 TLS Versions
    %dl.dl-horizontal.with-charts.with-charts
      - Stats.tls_versions.each do |record|
        %dt= record.tls_version_names.join(",")
        %dd= record.count
  .col-md-6
    %h3 TLS Cipher Suites
    %dl.with-charts
      - Stats.tls_cipher_suites.each do |record|
        %dt= record.tls_cipher_suite_names.join(",")
        %dd= record.count


%h2 ECDHE parameters

.row
  - %w( curve_type curve_id key_size ).each do |key|
    .col-md-6
      %h3= key
      %dl.dl-horizontal.with-charts.with-charts
        - Stats.field_count(:mx_hosts, "ecdhe_#{key}").each do |record|
          %dt= key=="curve_id" ? Curves.name(record[0]) : record[0]
          %dd= record[1]


%h2 Errors
%table.table.table-condensed.table-striped.table-hover
  - Stats.field_count(:mx_hosts, :error).each do |record|
    %tr
      %td= record[1]
      %td= record[0]


%h2 Hostnames per Address
%ul
  - Stats.hostnames_per_address.each do |mx_host|
    %li
      = mx_host.address
      .badge.bage-default= mx_host.count
